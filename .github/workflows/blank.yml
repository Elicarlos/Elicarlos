name: 🐍 Ultimate Snake Animation Generator

on:
  # Executa automaticamente a cada 24 horas às 00:00 UTC
  schedule:
    - cron: "0 0 * * *"  # Correção: estava faltando o último *
  
  # Permite execução manual do workflow
  workflow_dispatch:
    inputs:
      theme:
        description: 'Escolha o tema da animação'
        required: false
        default: 'all'
        type: choice
        options:
          - all
          - matrix
          - neon
          - retro
          - ocean
  
  # Executa a cada push na branch main
  push:
    branches:
      - main
    
jobs:
  generate:
    name: 🎮 Generate Epic Snake Animation
    permissions: 
      contents: write
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
      - name: 📥 Checkout repository
        uses: actions/checkout@v4
        
      - name: 🎯 Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          
      - name: 📊 Get contribution stats
        id: stats
        run: |
          # Simulação de coleta de estatísticas (você pode implementar via API)
          echo "total_contributions=1337" >> $GITHUB_OUTPUT
          echo "current_streak=42" >> $GITHUB_OUTPUT
          echo "generation_time=$(date '+%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_OUTPUT
        
      - name: 🐍 Generate Matrix Theme Snake
        if: ${{ github.event.inputs.theme == 'all' || github.event.inputs.theme == 'matrix' || github.event.inputs.theme == '' }}
        uses: Platane/snk/svg-only@v3
        with:
          github_user_name: ${{ github.repository_owner }}
          outputs: |
            dist/snake-matrix.svg?palette=github-dark&color_snake=#00ff41&color_dots=#003d0d,#006d1a,#00a82d,#00e63d,#39ff14
          
      - name: 🌊 Generate Ocean Theme Snake
        if: ${{ github.event.inputs.theme == 'all' || github.event.inputs.theme == 'ocean' || github.event.inputs.theme == '' }}
        uses: Platane/snk/svg-only@v3
        with:
          github_user_name: ${{ github.repository_owner }}
          outputs: |
            dist/snake-ocean.svg?palette=github-dark&color_snake=#00bfff&color_dots=#001f3f,#0074cc,#00a8ff,#3dd5f3,#74f7ff
            
      - name: 🕹️ Generate Retro Theme Snake
        if: ${{ github.event.inputs.theme == 'all' || github.event.inputs.theme == 'retro' || github.event.inputs.theme == '' }}
        uses: Platane/snk/svg-only@v3
        with:
          github_user_name: ${{ github.repository_owner }}
          outputs: |
            dist/snake-retro.svg?palette=github-dark&color_snake=#ff6b6b&color_dots=#2d1b69,#7209b7,#f72585,#4cc9f0,#4895ef
            
      - name: ⚡ Generate Neon Theme Snake
        if: ${{ github.event.inputs.theme == 'all' || github.event.inputs.theme == 'neon' || github.event.inputs.theme == '' }}
        uses: Platane/snk/svg-only@v3
        with:
          github_user_name: ${{ github.repository_owner }}
          outputs: |
            dist/snake-neon.svg?palette=github-dark&color_snake=#ff0080&color_dots=#0d0221,#460c68,#9a031e,#fb8500,#ffb700
            
      - name: 🌈 Generate Classic Themes
        uses: Platane/snk/svg-only@v3
        with:
          github_user_name: ${{ github.repository_owner }}
          outputs: |
            dist/github-contribution-grid-snake.svg
            dist/github-contribution-grid-snake-dark.svg?palette=github-dark
            dist/github-contribution-grid-snake-light.svg?palette=github
            
      - name: 📝 Create README with animations
        run: |
          cat > dist/README.md << 'EOF'
          # 🐍 Snake Animation Collection
          
          Generated on: ${{ steps.stats.outputs.generation_time }}
          Total Contributions: ${{ steps.stats.outputs.total_contributions }}
          Current Streak: ${{ steps.stats.outputs.current_streak }} days
          
          ## 🎨 Available Themes
          
          ### 🕹️ Matrix Theme
          ![Matrix Snake](./snake-matrix.svg)
          
          ### 🌊 Ocean Theme  
          ![Ocean Snake](./snake-ocean.svg)
          
          ### 🕹️ Retro Theme
          ![Retro Snake](./snake-retro.svg)
          
          ### ⚡ Neon Theme
          ![Neon Snake](./snake-neon.svg)
          
          ### 🌙 Dark Theme
          ![Dark Snake](./github-contribution-grid-snake-dark.svg)
          
          ### ☀️ Light Theme
          ![Light Snake](./github-contribution-grid-snake-light.svg)
          
          ---
          
          *Animations generated automatically by GitHub Actions* 🤖
          EOF
          
      - name: 🚀 Deploy to output branch
        uses: crazy-max/ghaction-github-pages@v4
        with:
          target_branch: output
          build_dir: dist
          commit_message: "🐍 Update snake animations collection [skip ci]"
          user_name: "snake-bot[bot]"
          user_email: "snake-bot[bot]@users.noreply.github.com"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      - name: 📢 Create release on significant updates
        if: github.event_name == 'push'
        run: |
          echo "🎉 Snake animations updated successfully!"
          echo "📊 Stats: ${{ steps.stats.outputs.total_contributions }} contributions"
          echo "🔥 Streak: ${{ steps.stats.outputs.current_streak }} days"
